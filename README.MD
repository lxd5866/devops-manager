# DevOps Manager - åˆ†å¸ƒå¼è¿ç»´ç®¡ç†ç³»ç»Ÿ

ğŸ“– é¡¹ç›®æ¶æ„è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®ç›®æ ‡
- æ”¯æŒ 10000+ å®¢æˆ·ç«¯èŠ‚ç‚¹ å¹¶å‘è¿æ¥ä¸æ§åˆ¶
- å®ç° agent â†’ server é•¿è¿æ¥å¿ƒè·³ï¼Œä¿è¯ä¸Šä¸‹çº¿å¯è§
- æ”¯æŒ æ‰¹é‡ä¸‹å‘ä»»åŠ¡ï¼ˆå‘½ä»¤æ‰§è¡Œ / æ–‡ä»¶åˆ†å‘ / è„šæœ¬è¿è¡Œï¼‰
- æ”¯æŒ èŠ‚ç‚¹åˆ†ç»„ / æ ‡ç­¾ç®¡ç†
- æä¾› RESTful API / Web ç•Œé¢ ä¾›ç”¨æˆ·è¿œç¨‹æ“ä½œ
- é›†æˆ Swagger API æ–‡æ¡£ï¼Œæ”¯æŒåœ¨çº¿æµ‹è¯•å’Œè°ƒè¯•
- é«˜å¯ç”¨ & å¯æ‰©å±•
- server å‰ç«¯ä½¿ç”¨ tailwindcss ï¼Œåç«¯ä½¿ç”¨ golang ginï¼Œclient ä½¿ç”¨golang 

## 2. æ•´ä½“æ¶æ„å›¾ï¼ˆé€»è¾‘ï¼‰

```
+---------------+       +------------------+       +------------------+
|   agent èŠ‚ç‚¹  | <---> |   Server         | <---> |   Web / API æ¥å£  |
| (1w+ æœºå™¨)     |       | (æ¥å…¥ & ä»»åŠ¡åˆ†å‘)  |       | (UI & ç®¡ç†å¹³å°)   |
+---------------+       +------------------+       +------------------+
        |                        |
        v                        v
+----------------+       +------------------+
|   Agent æ¨¡å—   |       |   Storage (DB)   |
| - å¿ƒè·³         |       | - èŠ‚ç‚¹ä¿¡æ¯       |
| - å‘½ä»¤æ‰§è¡Œ     |        | - ä»»åŠ¡è®°å½•       |
| - æ–‡ä»¶ä¼ è¾“     |        | - æ—¥å¿—å­˜å‚¨       |
| - web é¡µé¢    |        |                 |
+----------------+       +------------------+
```

## 3. é¡¹ç›®ç»“æ„
```
â”œâ”€â”€ agent/                    # Agentå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â””â”€â”€ main.go          # Agentå¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ config.yaml      # é»˜è®¤é…ç½®
â”‚   â”‚   â””â”€â”€ *.yaml           # å…¶ä»–ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ pkg/
â”‚   â”‚   â”œâ”€â”€ controller/      # HTTP/gRPCæ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_controller.go        # gRPCåŸºç¡€é€»è¾‘ï¼Œä¸å®ç°ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_host_controller.go   # gRPCä¸»æœºç›¸å…³ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_task_controller.go   # gRPCä»»åŠ¡ç›¸å…³ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_file_controller.go   # gRPCæ–‡ä»¶ä¼ è¾“ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ http_controller.go        # HTTPåŸºç¡€é€»è¾‘ï¼Œä¸å®ç°ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ http_host_controller.go   # HTTPä¸»æœºç›¸å…³ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ http_task_controller.go   # HTTPä»»åŠ¡ç›¸å…³ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ web_controller.go         # Webé¡µé¢æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ service/         # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ host_service.go           # ä¸»æœºæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_service.go           # ä»»åŠ¡æ‰§è¡ŒæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ file_service.go           # æ–‡ä»¶ä¼ è¾“æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ connection_service.go     # è¿æ¥ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ utils/           # å·¥å…·ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ system.go                 # ç³»ç»Ÿä¿¡æ¯å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ file.go                   # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ command.go                # å‘½ä»¤æ‰§è¡Œå·¥å…·
â”‚   â”‚   â””â”€â”€ config/          # é…ç½®ç®¡ç†
â”‚   â”‚       â””â”€â”€ config.go                 # é…ç½®åŠ è½½é€»è¾‘
â”‚   â””â”€â”€ web/                 # Agent Webé¡µé¢
â”‚       â”œâ”€â”€ static/          # é™æ€èµ„æº
â”‚       â””â”€â”€ templates/       # é¡µé¢æ¨¡æ¿
â”œâ”€â”€ server/                   # ServeræœåŠ¡ç«¯
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â””â”€â”€ main.go          # Serverå¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ config.yaml      # æœåŠ¡ç«¯é…ç½®
â”‚   â”œâ”€â”€ pkg/
â”‚   â”‚   â”œâ”€â”€ controller/      # HTTP/gRPCæ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_controller.go        # gRPCåŸºç¡€é€»è¾‘ï¼Œä¸å®ç°ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_host_controller.go   # gRPCä¸»æœºç®¡ç†ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc_task_controller.go   # gRPCä»»åŠ¡ç®¡ç†ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ http_controller.go        # HTTPåŸºç¡€é€»è¾‘ï¼Œä¸å®ç°ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ http_host_controller.go   # HTTPä¸»æœºç®¡ç†ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ http_task_controller.go   # HTTPä»»åŠ¡ç®¡ç†ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ web_controller.go         # Webç®¡ç†ç•Œé¢æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ service/         # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ host_service.go           # ä¸»æœºç®¡ç†æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_service.go           # ä»»åŠ¡è°ƒåº¦æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ user_service.go           # ç”¨æˆ·ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ database/        # æ•°æ®åº“è¿æ¥
â”‚   â”‚       â”œâ”€â”€ mysql.go                  # MySQLè¿æ¥
â”‚   â”‚       â””â”€â”€ redis.go                  # Redisè¿æ¥
â”‚   â””â”€â”€ web/                 # Server Webç®¡ç†ç•Œé¢
â”‚       â”œâ”€â”€ frontend/        # å‰ç«¯é¡¹ç›®ï¼ˆTailwindCSSï¼‰
â”‚       â”œâ”€â”€ static/          # é™æ€èµ„æº
â”‚       â””â”€â”€ templates/       # é¡µé¢æ¨¡æ¿
â”œâ”€â”€ api/                      # å…±äº«APIå®šä¹‰
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ host.go                       # ä¸»æœºæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ task.go                       # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ user.go                       # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ protobuf/            # ç”Ÿæˆçš„protobufä»£ç 
â”‚   â””â”€â”€ protobuf_base/       # protobufå®šä¹‰æ–‡ä»¶
â”‚       â”œâ”€â”€ host.proto                    # ä¸»æœºç›¸å…³åè®®
â”‚       â””â”€â”€ command.proto                 # å‘½ä»¤ç›¸å…³åè®®
â”œâ”€â”€ docs/                    # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ docs.go                          # Swaggeræ–‡æ¡£å…¥å£
â”‚   â”œâ”€â”€ swagger.json                     # Swagger JSONæ–‡æ¡£
â”‚   â”œâ”€â”€ swagger.yaml                     # Swagger YAMLæ–‡æ¡£
â”‚   â””â”€â”€ API_TESTING.md                   # APIæµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ scripts/                 # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ generate_proto.sh                # protobufç”Ÿæˆè„šæœ¬
â”‚   â””â”€â”€ generate_swagger.sh              # Swaggeræ–‡æ¡£ç”Ÿæˆè„šæœ¬
â””â”€â”€ examples/                # ç¤ºä¾‹ä»£ç 
    â””â”€â”€ command_client_example.go         # å®¢æˆ·ç«¯ç¤ºä¾‹
```

## 4. æ¨¡å—åˆ’åˆ†
### 4.1 Agent (å®¢æˆ·ç«¯)

#### éƒ¨ç½²åœ¨è¢«æ§æœåŠ¡å™¨ï¼Œè´Ÿè´£ï¼š
1. é•¿è¿æ¥ç®¡ç†ï¼šä½¿ç”¨ WebSocket é•¿è¿æ¥ server ç«¯ï¼Œåˆ›å»ºweb terminal 
2. å¿ƒè·³ä¸ŠæŠ¥ï¼šå®šæ—¶ä¸ŠæŠ¥çŠ¶æ€ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€è´Ÿè½½ç­‰å¯æ‰©å±•ï¼‰
3. Task æ‰§è¡Œï¼šæ¥å— server çš„ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œè¿”å›ç»“æœ
4. æ–‡ä»¶ä¼ è¾“ï¼šå¯æ”¯æŒ server ä¸‹å‘æ–‡ä»¶ / ä¸Šä¼ ç»“æœæ–‡ä»¶


### 4.2 Server (æ§åˆ¶ç«¯)
è¿è¡Œåœ¨ä¸­å¿ƒæœºæˆ¿æˆ–äº‘ä¸Šï¼Œè´Ÿè´£ï¼š
- agent ç®¡ç†ï¼šä½¿ç”¨ grpc é•¿è¿æ¥ä¸ agent è¿æ¥ï¼Œè®°å½•èŠ‚ç‚¹ä¸Šä¸‹çº¿ã€åˆ†ç»„ã€æ ‡ç­¾ã€èµ„æºæƒ…å†µ
- ä»»åŠ¡è°ƒåº¦ï¼šæ¥æ”¶ç®¡ç†å‘˜ä¸‹å‘çš„æ‰¹é‡ä»»åŠ¡ï¼Œåˆ†å‘ç»™èŠ‚ç‚¹,ç»Ÿä¸€æ”¶é›† agent æ‰§è¡Œç»“æœï¼Œå¹¶è®°å½•


### 4.3 Web / API ç®¡ç†ç«¯

#### æä¾›ç”¨æˆ·äº¤äº’å…¥å£ï¼š
- èŠ‚ç‚¹è§†å›¾ï¼ˆåœ¨çº¿ / ç¦»çº¿ / æ ‡ç­¾ / åˆ†ç»„ï¼‰
- æ‰¹é‡ä»»åŠ¡ä¸‹å‘ï¼ˆå‘½ä»¤ / æ–‡ä»¶åˆ†å‘ / è„šæœ¬è¿è¡Œï¼‰
- å†å²ä»»åŠ¡æŸ¥è¯¢ï¼ˆæˆåŠŸç‡ã€æ‰§è¡Œæ—¶é—´ã€æ—¥å¿—ï¼‰
- ç›‘æ§å‘Šè­¦ï¼ˆå¿ƒè·³ä¸¢å¤±æŠ¥è­¦ï¼‰

### 4.4 æ•°æ®å­˜å‚¨å±‚
- æ•°æ®åº“ï¼ˆMySQLï¼‰ï¼šå­˜å‚¨èŠ‚ç‚¹ä¿¡æ¯ã€ä»»åŠ¡è®°å½•ã€æ—¥å¿—
- ç¼“å­˜ï¼ˆRedisï¼‰ï¼šå­˜å‚¨èŠ‚ç‚¹çŠ¶æ€ã€å¿ƒè·³æ•°æ®ã€ä»»åŠ¡é˜Ÿåˆ—
#### è¡¨è®¾è®¡ï¼ˆç®€åŒ–ï¼‰ï¼š
- nodesï¼ˆèŠ‚ç‚¹è¡¨ï¼šidã€ipã€hostnameã€statusã€last_seenã€tagsï¼‰
- tasksï¼ˆä»»åŠ¡è¡¨ï¼šidã€commandã€statusã€create_timeï¼‰
- task_resultsï¼ˆä»»åŠ¡ç»“æœè¡¨ï¼štask_idã€node_idã€outputã€statusï¼‰


## 5. å¿«é€Ÿå¼€å§‹

### 5.1 ç¯å¢ƒä¾èµ–

- Go 1.21+
- MySQL å®ä¾‹ï¼ˆåœ¨ `config.yaml` ä¸­é…ç½® DSNï¼‰

### 5.2 è¿è¡Œæ­¥éª¤

1. æ ¹æ®å®é™…ç¯å¢ƒä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š
   - æœåŠ¡ç«¯é…ç½®ï¼š`server/config/config.yaml`
   - å®¢æˆ·ç«¯é…ç½®ï¼š`agent/config/config.yaml`

2. ç”Ÿæˆprotobufæ–‡ä»¶ï¼š
   ```bash
   bash scripts/generate_proto.sh
   ```

3. ç”ŸæˆSwaggeræ–‡æ¡£ï¼š
   ```bash
   # å®‰è£…swagå·¥å…·
   go install github.com/swaggo/swag/cmd/swag@latest
   
   # ç”Ÿæˆæ–‡æ¡£
   swag init -g server/cmd/main.go -o docs
   ```

4. å¯åŠ¨æœåŠ¡ç«¯ï¼š
   ```bash
   go run ./server/cmd/main.go
   ```

5. å¯åŠ¨å®¢æˆ·ç«¯ï¼š
   
   **ç®€å•æ¨¡å¼ï¼ˆä»…Agentå®¢æˆ·ç«¯ï¼‰ï¼š**
   ```bash
   go run ./agent/cmd/main.go
   ```
   
   **å®Œæ•´æ¨¡å¼ï¼ˆAgent + Webç•Œé¢ï¼‰ï¼š**
   ```bash
   go run ./agent/cmd/main.go -web
   ```
   
   **è‡ªå®šä¹‰ç«¯å£ï¼š**
   ```bash
   go run ./agent/cmd/main.go -web -web-port :8082 -grpc-port :50053
   ```

6. è®¿é—®Webç•Œé¢ï¼š
   - æœåŠ¡ç«¯ç®¡ç†ç•Œé¢ï¼šhttp://localhost:3000
   - æœåŠ¡ç«¯APIæ–‡æ¡£ï¼šhttp://localhost:8080/swagger/index.html
   - å®¢æˆ·ç«¯çŠ¶æ€ç•Œé¢ï¼šhttp://localhost:8081 (å¯ç”¨-webå‚æ•°æ—¶)

## 6. Agentè¯¦ç»†è¯´æ˜

### 6.1 Agentæ¶æ„
Agenté‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

#### æ§åˆ¶å™¨å±‚ (Controller)
- **grpc_controller.go**: gRPCåŸºç¡€æ¡†æ¶ï¼Œè´Ÿè´£æœåŠ¡æ³¨å†Œå’Œè·¯ç”±
- **grpc_host_controller.go**: ä¸»æœºç›¸å…³gRPCä¸šåŠ¡é€»è¾‘
- **grpc_task_controller.go**: ä»»åŠ¡æ‰§è¡ŒgRPCä¸šåŠ¡é€»è¾‘  
- **grpc_file_controller.go**: æ–‡ä»¶ä¼ è¾“gRPCä¸šåŠ¡é€»è¾‘
- **http_controller.go**: HTTPåŸºç¡€æ¡†æ¶ï¼Œè´Ÿè´£è·¯ç”±æ³¨å†Œ
- **http_host_controller.go**: ä¸»æœºç›¸å…³HTTP API
- **http_task_controller.go**: ä»»åŠ¡ç®¡ç†HTTP API
- **http_file_controller.go**: æ–‡ä»¶ç®¡ç†HTTP API
- **web_controller.go**: Webé¡µé¢æ§åˆ¶å™¨

#### æœåŠ¡å±‚ (Service)
- **host_service.go**: ä¸»æœºæ³¨å†Œã€çŠ¶æ€ä¸ŠæŠ¥ã€è¿æ¥ç®¡ç†
- **task_service.go**: ä»»åŠ¡æ‰§è¡Œã€çŠ¶æ€è·Ÿè¸ªã€ç»“æœæ”¶é›†
- **file_service.go**: æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ã€å®Œæ•´æ€§éªŒè¯
- **connection_service.go**: gRPCè¿æ¥ç®¡ç†ã€å¿ƒè·³ç»´æŠ¤

#### å·¥å…·å±‚ (Utils)
- **system.go**: ç³»ç»Ÿä¿¡æ¯æ”¶é›†ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰
- **file.go**: æ–‡ä»¶æ“ä½œå·¥å…·ï¼ˆå¤åˆ¶ã€MD5æ ¡éªŒç­‰ï¼‰
- **command.go**: å‘½ä»¤æ‰§è¡Œå·¥å…·ï¼ˆè·¨å¹³å°shellæ‰§è¡Œï¼‰

### 6.2 AgentåŠŸèƒ½ç‰¹æ€§

#### ä¸»æœºç®¡ç†
- è‡ªåŠ¨æ³¨å†Œåˆ°æœåŠ¡ç«¯
- å®šæœŸä¸ŠæŠ¥ç³»ç»ŸçŠ¶æ€
- æ”¯æŒæ ‡ç­¾å’Œåˆ†ç»„ç®¡ç†
- è¿æ¥çŠ¶æ€ç›‘æ§

#### ä»»åŠ¡æ‰§è¡Œ
- æ¥æ”¶æœåŠ¡ç«¯ä¸‹å‘çš„å‘½ä»¤
- æ”¯æŒè¶…æ—¶æ§åˆ¶
- å®æ—¶è¿”å›æ‰§è¡Œç»“æœ
- ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

#### æ–‡ä»¶ä¼ è¾“
- æ”¯æŒæ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- MD5å®Œæ•´æ€§æ ¡éªŒ
- æ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢
- ç›®å½•ç®¡ç†

#### Webç•Œé¢
- å®æ—¶çŠ¶æ€ç›‘æ§
- ä»»åŠ¡æ‰§è¡Œå†å²
- æ–‡ä»¶ç®¡ç†ç•Œé¢
- RESTful APIæ¥å£

### 6.3 é…ç½®è¯´æ˜

Agenté…ç½®æ–‡ä»¶ `agent/config/config.yaml`ï¼š

```yaml
server:
  address: "localhost:50051"    # æœåŠ¡ç«¯gRPCåœ°å€
  timeout: 10s                  # è¯·æ±‚è¶…æ—¶æ—¶é—´
  retry_interval: 5s            # é‡è¿é—´éš”

agent:
  report_interval: 30s          # çŠ¶æ€ä¸ŠæŠ¥é—´éš”
  client_id: ""                 # å®¢æˆ·ç«¯IDï¼ˆç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰
  tags:                         # è‡ªå®šä¹‰æ ‡ç­¾
    role: "agent"
    env: "production"
    version: "1.0.0"

logging:
  level: "info"                 # æ—¥å¿—çº§åˆ«
  format: "text"                # æ—¥å¿—æ ¼å¼
```

## 7. Swagger APIæ–‡æ¡£

### 7.1 Swagger UI è®¿é—®

ç³»ç»Ÿé›†æˆäº†å®Œæ•´çš„Swagger APIæ–‡æ¡£ï¼Œæä¾›åœ¨çº¿æµ‹è¯•å’Œè°ƒè¯•åŠŸèƒ½ï¼š

- **Swagger UIç•Œé¢**: http://localhost:8080/swagger/index.html
- **JSONæ ¼å¼æ–‡æ¡£**: http://localhost:8080/swagger/doc.json
- **YAMLæ ¼å¼æ–‡æ¡£**: http://localhost:8080/swagger/swagger.yaml

### 7.2 APIæ¥å£æ¦‚è§ˆ

#### ä¸»æœºç®¡ç† API
| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/v1/hosts` | è·å–æ‰€æœ‰å·²å‡†å…¥ä¸»æœºåˆ—è¡¨ |
| POST | `/api/v1/hosts/register` | æ³¨å†Œæ–°ä¸»æœºåˆ°ç³»ç»Ÿ |
| GET | `/api/v1/hosts/{id}` | è·å–æŒ‡å®šä¸»æœºè¯¦ç»†ä¿¡æ¯ |
| PUT | `/api/v1/hosts/{id}` | æ›´æ–°ä¸»æœºä¿¡æ¯ |
| DELETE | `/api/v1/hosts/{id}` | åˆ é™¤ä¸»æœº |
| POST | `/api/v1/hosts/{id}/status` | ä¸ŠæŠ¥ä¸»æœºçŠ¶æ€ |
| GET | `/api/v1/hosts/{id}/status` | è·å–ä¸»æœºçŠ¶æ€ |

#### å¾…å‡†å…¥ä¸»æœºç®¡ç† API
| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/v1/pending-hosts` | è·å–å¾…å‡†å…¥ä¸»æœºåˆ—è¡¨ |
| GET | `/api/v1/pending-hosts/count` | è·å–å¾…å‡†å…¥ä¸»æœºæ•°é‡ |
| POST | `/api/v1/pending-hosts/{id}/approve` | å‡†å…¥æŒ‡å®šä¸»æœº |
| POST | `/api/v1/pending-hosts/{id}/reject` | æ‹’ç»æŒ‡å®šä¸»æœº |

#### ä»»åŠ¡ç®¡ç† API
| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/v1/tasks` | åˆ›å»ºæ–°ä»»åŠ¡ |
| GET | `/api/v1/tasks` | è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µç­›é€‰ï¼‰ |
| GET | `/api/v1/tasks/{id}` | è·å–ä»»åŠ¡è¯¦ç»†ä¿¡æ¯ |
| PUT | `/api/v1/tasks/{id}` | æ›´æ–°ä»»åŠ¡ä¿¡æ¯ |
| GET | `/api/v1/tasks/{id}/commands` | è·å–ä»»åŠ¡çš„å‘½ä»¤æ‰§è¡Œè®°å½• |

### 7.3 APIè¯·æ±‚ç¤ºä¾‹

#### æ³¨å†Œä¸»æœº
```bash
curl -X POST "http://localhost:8080/api/v1/hosts/register" \
     -H "Content-Type: application/json" \
     -d '{
       "hostname": "web-server-01",
       "ip": "192.168.1.100",
       "os": "linux",
       "tags": {
         "role": "web",
         "env": "production"
       }
     }'
```

#### åˆ›å»ºä»»åŠ¡
```bash
curl -X POST "http://localhost:8080/api/v1/tasks" \
     -H "Content-Type: application/json" \
     -d '{
       "name": "éƒ¨ç½²åº”ç”¨",
       "description": "åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬",
       "host_ids": ["host-001", "host-002"],
       "command": "bash /opt/deploy.sh",
       "timeout": 300,
       "parameters": {
         "version": "1.2.3",
         "env": "production"
       }
     }'
```

#### è·å–ä¸»æœºåˆ—è¡¨
```bash
curl -X GET "http://localhost:8080/api/v1/hosts" \
     -H "accept: application/json"
```

### 7.4 å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": {
    // å®é™…æ•°æ®å†…å®¹
  },
  "message": "æ“ä½œæˆåŠŸ"
}
```

#### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error_message": "å…·ä½“é”™è¯¯ä¿¡æ¯",
  "message": "è¯·æ±‚å¤„ç†å¤±è´¥"
}
```

### 7.5 Swaggeræ–‡æ¡£ç”Ÿæˆ

#### å®‰è£…swagå·¥å…·
```bash
go install github.com/swaggo/swag/cmd/swag@latest
```

#### ç”Ÿæˆæ–‡æ¡£
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
swag init -g server/cmd/main.go -o docs

# æˆ–ä½¿ç”¨è„šæœ¬
bash scripts/generate_swagger.sh
```

#### æ·»åŠ APIæ³¨é‡Š
åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ Swaggeræ³¨é‡Šï¼š

```go
// CreateTask åˆ›å»ºä»»åŠ¡
// @Summary      åˆ›å»ºæ–°çš„æ‰§è¡Œä»»åŠ¡
// @Description  åœ¨æŒ‡å®šä¸»æœºä¸Šåˆ›å»ºå¹¶æ‰§è¡Œä»»åŠ¡
// @Tags         ä»»åŠ¡ç®¡ç†
// @Accept       json
// @Produce      json
// @Param        task  body      models.CreateTaskRequest  true  "ä»»åŠ¡ä¿¡æ¯"
// @Success      200   {object}  models.APIResponse{data=models.Task}
// @Failure      400   {object}  models.APIResponse
// @Failure      500   {object}  models.APIResponse
// @Router       /api/v1/tasks [post]
func (c *HTTPTaskController) CreateTask(ctx *gin.Context) {
    // å®ç°é€»è¾‘
}
```

### 7.6 åœ¨çº¿æµ‹è¯•

1. å¯åŠ¨æœåŠ¡ç«¯åï¼Œè®¿é—® Swagger UIï¼šhttp://localhost:8080/swagger/index.html
2. é€‰æ‹©è¦æµ‹è¯•çš„APIæ¥å£
3. ç‚¹å‡» "Try it out" æŒ‰é’®
4. å¡«å†™å¿…è¦çš„è¯·æ±‚å‚æ•°
5. ç‚¹å‡» "Execute" æ‰§è¡Œè¯·æ±‚
6. æŸ¥çœ‹å“åº”ç»“æœå’ŒçŠ¶æ€ç 

### 7.7 å¼€å‘æ³¨æ„äº‹é¡¹

1. **æ–‡æ¡£åŒæ­¥**: ä¿®æ”¹APIåéœ€è¦é‡æ–°ç”ŸæˆSwaggeræ–‡æ¡£
2. **æ³¨é‡Šè§„èŒƒ**: ä¸¥æ ¼æŒ‰ç…§swagæ³¨é‡Šæ ¼å¼ç¼–å†™
3. **æ¨¡å‹å®šä¹‰**: ç¡®ä¿æ‰€æœ‰è¯·æ±‚/å“åº”æ¨¡å‹éƒ½æœ‰å®Œæ•´çš„ç»“æ„ä½“å®šä¹‰
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€ä½¿ç”¨æ ‡å‡†çš„é”™è¯¯å“åº”æ ¼å¼
5. **ç‰ˆæœ¬ç®¡ç†**: APIç‰ˆæœ¬å˜æ›´æ—¶éœ€è¦æ›´æ–°æ–‡æ¡£ç‰ˆæœ¬ä¿¡æ¯

è¯¦ç»†çš„APIæµ‹è¯•æ–‡æ¡£å’Œç¤ºä¾‹è¯·å‚è€ƒï¼š[docs/API_TESTING.md](docs/API_TESTING.md)



        






